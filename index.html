<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zombie Game</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #333;
        }

        canvas {
            display: block;
        }

        .info {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-family: Arial, sans-serif;
            z-index: 10;
        }

        .permission-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 10px 20px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="info">Steuere den Spieler mit dem Accelerometer!</div>
    <canvas id="gameCanvas"></canvas>
    <button id="permissionButton" class="permission-button" style="display: none;">Aktiviere Steuerung</button>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const player = {
            x: canvas.width / 2,
            y: canvas.height / 2,
            radius: 20,
            color: 'blue',
            direction: { x: 0, y: 1 }, // Initial direction facing down
        };

        const zombies = [];
        const zombieSpeed = 2;

        let tiltX = 0;
        let tiltY = 0;

        // Request permission for accelerometer usage
        const permissionButton = document.getElementById('permissionButton');

        function requestPermission() {
            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission()
                    .then((response) => {
                        if (response === 'granted') {
                            window.addEventListener('deviceorientation', handleOrientation);
                            permissionButton.style.display = 'none';
                        } else {
                            alert('Accelerometer-Zugriff wurde verweigert.');
                        }
                    })
                    .catch(console.error);
            } else {
                // For browsers that don't require permission
                window.addEventListener('deviceorientation', handleOrientation);
                permissionButton.style.display = 'none';
            }
        }

        function handleOrientation(event) {
            tiltX = event.gamma || 0; // Left to right
            tiltY = event.beta || 0; // Front to back
        }

        if (typeof DeviceOrientationEvent.requestPermission === 'function') {
            permissionButton.style.display = 'block';
            permissionButton.addEventListener('click', requestPermission);
        } else {
            window.addEventListener('deviceorientation', handleOrientation);
        }

        function drawPlayer() {
            ctx.save();
            ctx.translate(player.x, player.y);

            // Calculate rotation based on direction
            const angle = Math.atan2(player.direction.y, player.direction.x);
            ctx.rotate(angle);

            // Draw body (circle)
            ctx.beginPath();
            ctx.arc(0, 0, player.radius, 0, Math.PI * 2);
            ctx.fillStyle = player.color;
            ctx.fill();
            ctx.closePath();

            // Draw front (triangle)
            ctx.beginPath();
            ctx.moveTo(player.radius, 0);
            ctx.lineTo(player.radius / 2, -player.radius / 2);
            ctx.lineTo(player.radius / 2, player.radius / 2);
            ctx.closePath();
            ctx.fillStyle = 'white';
            ctx.fill();

            ctx.restore();
        }

        function spawnZombie() {
            const side = Math.floor(Math.random() * 4); // 0 = top, 1 = right, 2 = bottom, 3 = left
            let x, y;

            if (side === 0) {
                x = Math.random() * canvas.width;
                y = -20;
            } else if (side === 1) {
                x = canvas.width + 20;
                y = Math.random() * canvas.height;
            } else if (side === 2) {
                x = Math.random() * canvas.width;
                y = canvas.height + 20;
            } else {
                x = -20;
                y = Math.random() * canvas.height;
            }

            zombies.push({ x, y, radius: 15, color: 'red' });
        }

        function drawZombies() {
            zombies.forEach((zombie) => {
                ctx.beginPath();
                ctx.arc(zombie.x, zombie.y, zombie.radius, 0, Math.PI * 2);
                ctx.fillStyle = zombie.color;
                ctx.fill();
                ctx.closePath();
            });
        }

        function updatePlayer() {
            player.x += tiltX * 0.5;
            player.y += tiltY * 0.5;

            // Update direction
            if (tiltX !== 0 || tiltY !== 0) {
                const magnitude = Math.sqrt(tiltX * tiltX + tiltY * tiltY);
                player.direction.x = tiltX / magnitude;
                player.direction.y = tiltY / magnitude;
            }

            // Boundaries
            player.x = Math.max(player.radius, Math.min(canvas.width - player.radius, player.x));
            player.y = Math.max(player.radius, Math.min(canvas.height - player.radius, player.y));
        }

        function updateZombies() {
            zombies.forEach((zombie) => {
                const dx = player.x - zombie.x;
                const dy = player.y - zombie.y;
                const dist = Math.sqrt(dx * dx + dy * dy);

                zombie.x += (dx / dist) * zombieSpeed;
                zombie.y += (dy / dist) * zombieSpeed;
            });
        }

        function checkCollisions() {
            zombies.forEach((zombie, index) => {
                const dx = player.x - zombie.x;
                const dy = player.y - zombie.y;
                const dist = Math.sqrt(dx * dx + dy * dy);

                if (dist < player.radius + zombie.radius) {
                    alert('Game Over!');
                    zombies.splice(index, 1);
                    resetGame();
                }
            });
        }

        function resetGame() {
            player.x = canvas.width / 2;
            player.y = canvas.height / 2;
            zombies.length = 0;
        }

        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            drawPlayer();
            drawZombies();
            updatePlayer();
            updateZombies();
            checkCollisions();

            requestAnimationFrame(gameLoop);
        }

        setInterval(spawnZombie, 1000);
        gameLoop();
    </script>
</body>
</html>
